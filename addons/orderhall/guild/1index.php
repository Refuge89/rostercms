<?php
//d($addon);
if ( !isset($_POST['process']) )
{
	$roster->tpl->set_handle('orderhalladd', $addon['basename'] . '/charselect.html');
	$roster->tpl->display('orderhalladd');
}
else
{
	//d($_POST);
	
	$classes = array(
		'1' =>  array(
		'42814','42815','38904','39654','40579','41105','40043','39191','39530','39192','39214','40585','42597','42484','42598','42606','42605','42607','42609','42610','42611','42193','42650','42651','42107','42614','42110','42204','43585','43975','44255','43888','43586','44667','42918','42616','42618','43506','43577','42974','42619','43425'
		),

		'2' => array( '42853','42854','42855','42856','38933','39696','39756','42844','42846','42847','42848','42849','42850','42851','42852','42866','42867','42881','42885','42886','42887','42888','42890','42919','42966','42967','42968','43462','43486','43487','43488','43489','43490','43491','43492','43493','43494','43534','43535','43540','43541','43697','43698','43699','43700','43701','43785','43933','43934','44250','42135','42136','42960','42961','45770','46069','46070','46071','46074','46083','45143','45145','45146','45147','45148','45149','45890','46045','46259'
		),

		'3' => array( '40957','42133','42134','42384','42385','42386','42387','42388','42389','42390','42391','42392','42393','42394','42395','42397','42398','42399','42400','42401','42402','42403','42404','42405','42406','42407','42408','42409','42410','42411','42412','42413','42414','42415','42436','42519','42523','42524','42525','42526','42654','42655','42656','42657','42658','42659','42689','42691','42928','42929','42930','43182','43335','44090','44233','44680','46336','46337','45551','45552','45553','45554','45555','45556','45557','46048','46060','46235'
		),

		'4' => array( '40832','40839','40840','42501','42502','42503','42539','42568','42627','40847','40849','41919','41920','41921','41922','41924','40950','40994','40995','43007','42139','42140','43013','43014','43015','43958','43829','44041','44116','44155','44117','44177','44183','43841','43852','44181','42684','43468','43253','43249','43250','44252','42730','43885','44178','44180','43251','43252','42678','42680','42800','43469','43470','43479','43485','43508','37666','37448','37494','37689','43723','43724','44215','43422'
		),

		'5' => array( '40705','40706','40710','41957','41966','41967','41993','42074','41625','41626','41627','41628','41629','41630','41631','41632','40938','41015','41017','41019','43270','43271','43272','43265','43275','43276','43277','43371','43372','43373','43374','43375','43376','42137','42138','43378','43379','43851','43384','43377','43383','43380','43385','44251','43884','43386','43387','43388','43389','43381','43390','43391','43392','43382','43394','43396','43395','43397','43797','43400','43399','43832','43401','43398','43402','43420'
		),

		'6' => array( '42029','42030','39799','39816','39818','39832','42449','42484','42533','42534','42535','42536','42537','42708','42818','42821','42823','42824','42882','43264','43265','43266','43267','43268','43539','43571','43572','43573','43574','43686','43899','43928','44082','44217','44243','44244','44245','44246','44247','44248','44282','44286','44550','44690','46050','43836','46719','46720','46812','46813','44775','44783','44787','45103','45240','45243','45331','45398','45399','46305'
		),

		'7' => array( '39746','41335','43334','43338','39771','43644','43645','40341','42931','42932','42933','42935','42936','42937','40224','40225','40276','41510','44544','42188','42114','42383','42198','42197','42141','42142','41741','41740','42184','44101','42977','43002','41770','41771','41776','41742','41743','44465','42986','42996','42983','42984','44253','43886','41901','42200','41775','42068','41777','41897','41898','41899','42065','41900','41746','41747','42208','41772','42988','42995','43003','42990','41773','41934','41888','41744','41745','43418'
		),

		'8' => array( '41035','41036','41085','40267','40270','42001','42006','42007','42008','42009','42010','42011','42452','42455','42476','42477','42479','41114','41125','41112','41113','41124','41141','42663','42685','42662','42703','42126','42127','42696','42433','42429','42418','42434','42435','42166','42206','42149','42171','42222','42706','42705','44098','42416','42423','42424','42451','44240','43749','42954','42955','42956','42959','42704','44689','42508','42521','42494','42702','42493','42520','42707','42940','42734','42917','42914','43415'
		),

		'9' => array( '40716','40729','40684','40495','40588','40604','40606','40611','40623','42128','42168','42125','43100','43153','43254','40712','40731','40823','40824','44099','42608','42603','41797','42602','42601','42097','41759','39179','39389','39142','40218','41767','41798','41752','41753','42100','43887','44254','42098','41768','41769','41781','41780','41784','41754','41751','44682','42660','42103','42102','41785','41788','41787','41793','41755','41795','41756','41796'
		),

		'10' => array( '32442','40704','40793','40795','41038','41039','41040','41059','41086','41087','41115','41728','41729','41730','41731','41732','41733','41734','41735','41736','41737','41738','41739','41849','41850','41851','41852','41853','41854','41905','41907','41909','41910','41911','41945','41946','42186','42187','42191','42210','43054','43058','43060','43061','43062','43151','43319','44249','45404','45440','45442','45449','45459','45545','45574','45771','45790','46320','46341','46342','46343','46344','46346','46347','46348','46349','46350','46353'
		),

		'11' => array( '40643','41106','40644','40645','40646','40783','40784','40785','40834','40835','40837','40838','42428','42438','42439','42440','42430','41468','41782','41783','41790','41791','41792','40647','40649','41422','41449','41436','41690','41689','41918','40651','41332','40652','40653','42516','42583','40650','42096','42584','42585','42586','41413','42588','42032','42031','42033','42035','42036','42038','42039','42037','43991','40654','44077','44076','44075','44074','44232','42040','42042','42043','42044','42045','42046','42048','42047','43365','42719','42129','42049','42365','42051','43368','42050','42053','42055','42056','43409'
		),

		'12' => array( '39261','40814','41120','41121','41119','40247','41804','41806','41807','40249','42869','42872','41033','41037','41062','41064','44087','42671','42677','42679','42681','42683','42682','37447','42510','42522','42593','42594','42921','42665','42131','42731','42801','42787','42735','42736','42737','42739','42738','42749','42752','42775','42776','42669','42802','42808','43878','44213','44694','42733','44616','42732','42754','42810','42920','42132','43186'
		)
	);

	//$roster->api2->ignore_cache = true;

	$roster->api2->ignore_cache = true;
	$roster->api2->set_region($_POST['region']);
	$a = $roster->api2->fetch('character',array('name'=>$_POST['char'],'server'=>$_POST['server'],'fields'=>'quests'));
$roster->api2->ignore_cache = false;
	$comp = 0;
	$total = count($classes[$a['class']]);
	foreach ($classes[$a['class']] as $quest)
	{
		$q = $roster->api2->fetch('quest',array('id'=>$quest));
		$c = false;
		$img = '';
		if (in_array($quest, $a['quests']) )
		{
			$comp++;
			$c = true;
			$img = 'complete';
		}
		else
		{
			$img = 'incomplete';
		}
		//echo '<tr class="'.$c.'"><td>'.$q['title'].' ( '.$q['reqLevel'].' )</td><td>'.$c.'</td></tr>';
		$roster->tpl->assign_block_vars('quests', array(
				'NAME'		=> $q['title'],
				'LEVEL'		=> $q['reqLevel'],
				'COMPLETE'	=> $c,
				'IMG'		=> $img,
				'WOWHEAD'	=> 'http://www.wowhead.com/quest='.$quest.'',
			));
				
		
	}
	$roster->tpl->assign_vars(array(
			'TOTAL'		=> $total,
			'COMP'		=> $comp,
			'BAR'		=> ceil($comp / $total * 100),
			'IMG_URL'	=> $addon['image_url'],
		));

	$roster->tpl->set_handle('orderhalladd', $addon['basename'] . '/questlist.html');
	$roster->tpl->display('orderhalladd');
}